<!DOCTYPE html>
<!-- saved from url=(0039)http://getbootstrap.com/examples/blog/# -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="dmlaomao">
    <link rel="icon" href="http://getbootstrap.com/favicon.ico">

    <title>Blog</title>

    <!-- Bootstrap core CSS -->
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="http://getbootstrap.com/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/blog/blog.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="./posts_files/ie-emulation-modes-warning.js"></script><style type="text/css"></style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/mystyle.css" />
<script src="js/main.js"></script>
</head>

<body>


<div class = "mycustom" style = "display:none;">
<div class="dropdown">
  <button class="btn btn-default dropdown-toggle" type="button"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" id = "username">
    Dropdown
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="#">Action</a></li>
    <li><a href="#">Another action</a></li>
    <li role="separator" class="divider"></li>
    <li><a href="#">Separated link</a></li>
  </ul>
</div>
<div class="dropdown">
  <button class="btn btn-default" type="button" id = "postbutton" >
   发博文 
  </button>
</div>
</div>


<script language="javascript" type="text/javascript">
function showdiv() {            
            document.getElementById("bg").style.display ="block";
            document.getElementById("show").style.display ="block";
        }
function hidediv() {
            document.getElementById("bg").style.display ='none';
            document.getElementById("show").style.display ='none';
        }
</script>
<style type="text/css">
        #bg{ display: none;  position: fixed;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index:1001;  -moz-opacity: 0.7;  opacity:.70;  filter: alpha(opacity=70);}
        #show{display: none;  position: fixed;  top: 10%;  left: 22%;  width: 53%;  height: 80%;  padding: 8px;  border: 8px solid #E8E9F7;  background-color: white;  z-index:1002;  overflow: auto;}
</style>
<div id="bg"></div>
<div id="show">
    <textarea class="form-control" rows="1" placeholder="我是标题" id = "blogtitle"></textarea>
    <textarea class="form-control" rows="25" placeholder="我是正文" id = "blogcontent"></textarea>
    <button type="submit" class="btn btn-info" id = "postblog" style = "relative:right">提交博文</button>
</form>
<input class = "btn btn-warning" id="btnclose" type="button" value="放弃提交" style = "positon:relative;float:right" onclick = "hidediv();">
</div>
  




<div id="main">
    <div class="demo">
        <nav class="main_nav">
            <ul>
                <li><div class="cd-signin" >登录</div></li>
                <li><div class="cd-signup" >注册</div></li>
            </ul>
        </nav>
    </div>
    <div class="cd-user-modal"> 
        <div class="cd-user-modal-container">
            <ul class="cd-switcher">
                <li><a href = "#0"><用户登录></a></li>
                <li><a href = "#0"><注册新用户></a></li>
            </ul>

            <div id="cd-login"> <!-- 登录表单 -->
                <form class="cd-form">
                    <p class="fieldset">
                        <label class="image-replace cd-username" for="signin-username">用户名</label>
                        <input class="full-width has-padding has-border" id="signin-username" type="text" placeholder="输入用户名">
                    </p>
                    <p class="fieldset">
                        <label class="image-replace cd-password" for="signin-password">密码</label>
                        <input class="full-width has-padding has-border" id="signin-password" type="password"  placeholder="输入密码">
                    </p>
                    <p class="fieldset">
                        <input type="checkbox" id="remember-me" checked>
                        <label for="remember-me">记住登录状态</label>
                    </p>
                    <p class="fieldset">
                        <input class="full-width2" id = "login" type="button" value="登 录">
                    </p>
                </form>

            </div>
            <div id="cd-signup"> <!-- 注册表单 -->
                <form class="cd-form">
                    <p class="fieldset">
                        <label class="image-replace cd-username" for="signup-username">用户名</label>
                        <input class="full-width has-padding has-border" id="signup-username" type="text" placeholder="输入用户名">
                    </p>
                    <p class="fieldset">
                        <label class="image-replace cd-email" for="signup-email">邮箱</label>
                        <input class="full-width has-padding has-border" id="signup-email" type="email" placeholder="输入mail">

                    </p>
                    <p class="fieldset">
                        <label class="image-replace cd-password" for="signup-password">密码</label>
                        <input class="full-width has-padding has-border" id="signup-password" type="password"  placeholder="输入密码">
                    </p>
                    <p class="fieldset">
                        <label class="image-replace cd-password" for="signup-password">密码</label>
                        <input class="full-width has-padding has-border" id="signup-password2" type="password"  placeholder="请再次输入密码">
                    </p>

                    <p class="fieldset">
                        <input type="checkbox" id="accept-terms">
                        <label for="accept-terms">我已阅读并同意 <a href="#0">用户协议</a></label>
                    </p>
                    <p class="fieldset">
                        <input class="full-width2" id = "register" type="button" value="注册新用户">
                    </p>
                </form>
            </div>
        </div>
    </div> 
</div> 


    <div class="container">

      <div class="blog-header">
        <h class="blog-title">dmlaomao's Blog</h>
        <p class="lead blog-description">闷声发大财</p>
      </div>


      <div class="row">

        <div class="col-sm-8 blog-main" >
            <div id = "jspostblog"></div>


<!--
          <div class="blog-post">
            <h2 class="blog-post-title">New feature</h2>
            <p class="blog-post-meta">December 14, 2013 by <a href="./posts_files/posts.html">Chris</a></p>

            <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aenean lacinia bibendum nulla sed consectetur. Etiam porta sem malesuada magna mollis euismod. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
            <ul>
              <li>Praesent commodo cursus magna, vel scelerisque nisl consectetur et.</li>
              <li>Donec id elit non mi porta gravida at eget metus.</li>
              <li>Nulla vitae elit libero, a pharetra augue.</li>
            </ul>
            <p>Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>
            <p>Donec ullamcorper nulla non metus auctor fringilla. Nulla vitae elit libero, a pharetra augue.</p>
          </div>
-->


<nav>
  <ul class="pagination pagination-lg" id = "pagenumber">
  </ul>
</nav>


        </div><!-- /.blog-main -->

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar" style = "text-align:top;">
          <div class="sidebar-module sidebar-module-inset">
            <h4>About</h4>
            <p>To be or not to be.</p>
          </div>
          <div class="sidebar-module">
            <h4>Archives</h4>
            <ol class="list-unstyled">
              <li><a href="./posts_files/posts.html">March 2014</a></li>
              <li><a href="./posts_files/posts.html">February 2014</a></li>
              <li><a href="./posts_files/posts.html">January 2014</a></li>
              <li><a href="./posts_files/posts.html">December 2013</a></li>
              <li><a href="./posts_files/posts.html">November 2013</a></li>
              <li><a href="./posts_files/posts.html">October 2013</a></li>
              <li><a href="./posts_files/posts.html">September 2013</a></li>
              <li><a href="./posts_files/posts.html">August 2013</a></li>
            </ol>
          </div>
          <div class="sidebar-module">
            <h4>Elsewhere</h4>
            <ol class="list-unstyled">
              <li><a href="./posts_files/posts.html">GitHub</a></li>
              <li><a href="./posts_files/posts.html">Facebook</a></li>
            </ol>
          </div>
        </div><!-- /.blog-sidebar -->

      </div><!-- /.row -->

    </div><!-- /.container -->

    <footer class="blog-footer">
      <p>Blog template built for <a href="http://getbootstrap.com/">Bootstrap</a> by <a href="https://twitter.com/mdo">@mdo</a>.</p>
      <p>
        <a href="./posts_files/posts.html">Back to top</a>
      </p>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./posts_files/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="./posts_files/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./posts_files/ie10-viewport-bug-workaround.js"></script>
  



<script>
//for paganation
$(document).ready(function(){
           $.ajax({
                type: "POST",
                url : "/getPageNum",
                cache:false,
                async:false,
                data:{
                },
                success: function (data) {
                    var num = data;
                    var i = 1;
                    var t1 = "<li><a aria-label=\"Previous\"> <span aria-hidden=\"true\">&laquo;</span></a></li>";
                    $("#pagenumber").append(t1);
                    while(i < num+1) {
                        var tmp = "<li" + " id = \"" + i + "\"><a class = \"pagecla\" value = \"" + i + "\""+ "\">"+i+"</a></li>";
                        i++;
                        $("#pagenumber").append(tmp);
                    }
                    var t2 = "<li><a  aria-label=\"Next\"> <span aria-hidden=\"true\">&raquo;</span></a></li>";
                    $("#pagenumber").append(t2);
                }
            });
});
</script>




<script>
//load the first page by default 
$(document).ready(function(){
           $.ajax({
                type: "POST",
                url : "/blog",
                cache:false,
                async:false,
                data:{
                    page:"0"
                },
                success: function (data) {
                    $(".active").attr("class","");
                    $("#1").attr("class","active");
                    var blogData = data;
                    //remove the current page to append the new one
                    $("#jspostblog").empty();
                    $.each($.parseJSON(blogData), function(idx, obj) {
                        var t1 = "<div class=\"blog-post\">";
                        var t2 = "<h class=\"blog-post-title\">" + obj.title + "</h>";
                        var t3 = "<p class=\"blog-post-meta\">" + obj.time + " by <a href=\"./about.html\" >" + obj.name + "</a></p>";
                        var content = obj.content.replace(/\n/g,"<br>");
                        var condis = content.substr(0,100);
                        var conhid = content.substr(100);
                        var t4 = "<p class =\"curcon\">" + condis + "</p>";
                        var t5 = "<p class =\"hidcon\" style = \"display:none\">" + conhid + "</p></div>";
                        $("#jspostblog").append(t1,t2,t3,t4,t5);
                    });
                    $("body").animate({scrollTop:0}, "slow"); 
                }
            });
});
</script>


<script>
//load the required page 
$(document).ready(function(){
    $("a.pagecla").click(function(){
        $(".active").attr("class","");
        $(this).parent().attr("class","active");
        var num = $(this).attr("value")-1;
           $.ajax({
                type: "POST",
                url : "/blog",
                cache:false,
                async:false,
                data:{
                    page:num
                },
                success: function (data) {
                    var blogData = data;
                    //remove the current page to append the new one
                    $("#jspostblog").empty();
                    //add the new one
                    $.each($.parseJSON(blogData), function(idx, obj) {
                        var t1 = "<div class=\"blog-post\">";
                        var t2 = "<h class=\"blog-post-title\">" + obj.title + "</h>";
                        var t3 = "<p class=\"blog-post-meta\">" + obj.time + " by <a href=\"./about.html\" >" + obj.name + "</a></p>";
                        var content = obj.content.replace(/\n/g,"<br>");
                        var condis = content.substr(0,100);
                        var conhid = content.substr(100);
                        var t4 = "<p class =\"curcon\">" + condis + "</p>";
                        var t5 = "<p class =\"hidcon\" style = \"display:none\">" + conhid + "</p></div>";
                        $("#jspostblog").append(t1,t2,t3,t4,t5);
                    });
                    //back to top
                    $("body").animate({scrollTop:0}, "slow"); 
                }
            });
    })
});
</script>





<script>
//$(document).ready(function(){
        $("#login").click(function(){
            $.ajax({
                type: "POST",
                url: "/login",
                cache:false,
                async:false,
                data:{
                    name:$("#signin-username").val(),
                    password:$("#signin-password").val(),
                },
                success: function (data) {
                    var tmp = new Array();
                    tmp = data.split(" ");
                    alert(tmp[0]);  
                    if (tmp[0] == "登录成功!") {
                        sessionStorage.userName = $("#signin-username").val();
                        sessionStorage.token = tmp[1];
                        sessionStorage.registerTime = tmp[2];
                        $("div.cd-user-modal").fadeOut();
                        $("#main").fadeOut();
                        $("#username").text(sessionStorage.userName);
                        $(".mycustom").fadeIn();
                    }
                },
                error: function() {
                    alert("error");
                }
            });
        });


        $("#register").click(function(){
            //if two password inputs are identical
            if ($("#signup-password").val() == $("#signup-password2").val()) {
                $.ajax({
                    type: "POST",
                    url: "/register",
                    cache:false,
                    async:false,
                    data:{
                        name:$("#signup-username").val(),
                        password:$("#signup-password").val(),
                        email:$("#signup-email").val(),
                    },
                    success: function (data) {
                        var tmp = new Array();
                        tmp = data.split(" ");
                        alert(tmp[0]);  
                        if (tmp == "注册成功!") {
                            //store token into session storage
                            sessionStorage.token = tmp[1];
                            sessionStorage.registerTime = tmp[2];
                            $("div.cd-user-modal").fadeOut();
                            $("#main").fadeOut();
                            $("#username").text(sessionStorage.userName);
                            $(".mycustom").fadeIn();
                        }
                    },
                    error: function() {
                        alert("error");
                    }
                });
            }
            else {
                alert("两次密码不一致,请重新输入");
            }
        });
//});
</script>

<script>
        $("#postbutton").click(function(){
                $.ajax({
                    type: "POST",
                    url: "/tokenvalid",
                    cache:false,
                    async:false,
                    data:{
                        token:sessionStorage.getItem("token"),
                    },
                    success: function (data) {
                        if (data == "false") {
                            alert("登录信息过期，请重新登录");
                            $(".mycustom").fadeOut();
                            $("#main").fadeIn();
                            $("div.cd-user-modal").fadeIn();
                        }
                        else 
                            showdiv();
                    },
                    error: function() {
                        alert("error");
                    }
                });
        });
</script>

<script>
        $("#postblog").click(function(){
            if ($.trim($("#blogtitle").val()) == '')
                alert("标题不能为空")
            else if ($.trim($("#blogcontent").val()) == '')
                alert("内容不能为空")
            else { 
                $.ajax({
                    type: "POST",
                    url: "/postblog",
                    cache:false,
                    async:false,
                    data:{
                        title:$("#blogtitle").val(),
                        content:$("#blogcontent").val(),
                        //can not use session storage name for safety reasons
                        token:sessionStorage.getItem("token"),
                    },
                    success: function (data) {
                        if (data == "true")
                            hidediv();
                        else {
                            alert("登录信息过期，请重新登录");
                            $(".mycustom").fadeOut();
                            $("#main").fadeIn();
                            $("div.cd-user-modal").fadeIn();
                        }
                    },
                    error: function() {
                        alert("error");
                    }
                });
            }
        });
</script>


<script>
//onclick show contents
    $(document).ready(function(){
        $("#jspostblog").delegate(".curcon","click",function(){
                $(this).next().slideToggle();
        })
    })
</script>


</body><div></div><div></div></html>
